openapi: 3.0.3
info:
  title: RULEX API
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Java Core (dev)
paths:
  /api/transactions/analyze:
    post:
      summary: Analyze a transaction
      operationId: analyzeTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeTransactionRequest'
      responses:
        '200':
          description: Analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeTransactionResponse'
  /api/transactions/analyze-advanced:
    post:
      summary: Analyze a transaction using advanced hard rules
      operationId: analyzeTransactionAdvanced
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeTransactionRequest'
      responses:
        '200':
          description: Analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeTransactionResponse'
  /api/transactions:
    get:
      summary: List transactions
      operationId: listTransactions
      parameters:
        - in: query
          name: customerId
          schema: { type: string }
        - in: query
          name: merchantId
          schema: { type: string }
        - in: query
          name: mcc
          schema: { type: integer }
        - in: query
          name: minAmount
          schema: { type: number }
        - in: query
          name: maxAmount
          schema: { type: number }
        - in: query
          name: startDate
          schema: { type: string, format: date-time }
        - in: query
          name: endDate
          schema: { type: string, format: date-time }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAnalyzeTransactionResponse'
  /api/transactions/{id}:
    get:
      summary: Get transaction by internal id
      operationId: getTransaction
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: Transaction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeTransactionResponse'
  /api/transactions/external/{externalId}:
    get:
      summary: Get transaction by external id
      operationId: getTransactionByExternalId
      parameters:
        - in: path
          name: externalId
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Transaction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeTransactionResponse'
  /api/rules:
    get:
      summary: List rules
      operationId: listRules
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged rules
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageRule'
    post:
      summary: Create rule
      operationId: createRule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Rule'
      responses:
        '201':
          description: Rule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rule'
  /api/rules/{id}:
    get:
      summary: Get rule
      operationId: getRule
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: Rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rule'
    put:
      summary: Update rule
      operationId: updateRule
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Rule'
      responses:
        '200':
          description: Rule updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rule'
    delete:
      summary: Delete rule
      operationId: deleteRule
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '204':
          description: Deleted
  /api/rules/{id}/toggle:
    patch:
      summary: Toggle rule enabled
      operationId: toggleRule
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: Updated rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rule'

  /api/rules/enabled/{enabled}:
    get:
      summary: List rules by enabled status
      operationId: listRulesByEnabled
      parameters:
        - in: path
          name: enabled
          required: true
          schema: { type: boolean }
      responses:
        '200':
          description: List of rules filtered by enabled status
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Rule'

  /api/rules/{id}/history:
    get:
      summary: Get rule change history (append-only)
      operationId: getRuleHistory
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: Rule change history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RuleHistoryEntry'

  /api/rules/validate:
    post:
      summary: Validate a rule AST (v3.1)
      operationId: validateRuleAst
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateAstRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AstValidationResult'

  /api/rules/lint:
    post:
      summary: Lint a rule AST (v3.1)
      operationId: lintRuleAst
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateAstRequest'
      responses:
        '200':
          description: Lint result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AstLintResult'

  /api/rules/simulate:
    post:
      summary: Simulate rule decisions and return features used (v3.1)
      operationId: simulateRulesV31
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/V31SimulateRequest'
      responses:
        '200':
          description: Simulation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/V31SimulateResponse'

  /api/field-dictionary:
    get:
      summary: List payload field dictionary (catalog-driven UI)
      operationId: listFieldDictionary
      parameters:
        - in: query
          name: workflow
          schema: { type: string }
        - in: query
          name: recordType
          schema: { type: string }
        - in: query
          name: portfolio
          schema: { type: string }
      responses:
        '200':
          description: Field dictionary entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FieldDictionaryEntry'

  /api/feature-catalog:
    get:
      summary: List feature catalog entries (v3.1)
      operationId: listFeatureCatalog
      parameters:
        - in: query
          name: featureType
          schema: { type: string }
        - in: query
          name: entityType
          schema: { type: string }
        - in: query
          name: source
          schema: { type: string }
      responses:
        '200':
          description: Feature definitions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeatureDefinition'

  /api/feature-catalog/{featureName}:
    get:
      summary: Get a feature definition by name
      operationId: getFeatureCatalogByName
      parameters:
        - in: path
          name: featureName
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Feature definition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureDefinition'
        '404':
          description: Not found

  /api/feature-catalog/types:
    get:
      summary: List feature types
      operationId: listFeatureTypes
      responses:
        '200':
          description: Feature types
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /api/feature-catalog/entity-types:
    get:
      summary: List feature entity types
      operationId: listFeatureEntityTypes
      responses:
        '200':
          description: Entity types
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /api/feature-catalog/sources:
    get:
      summary: List feature sources
      operationId: listFeatureSources
      responses:
        '200':
          description: Sources
          content:
            application/json:
              schema:
                type: array
                items: { type: string }

  /api/audit/executions:
    get:
      summary: List rule executions (audit console)
      operationId: listAuditExecutions
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
        - in: query
          name: externalTransactionId
          schema: { type: string }
      responses:
        '200':
          description: Paged executions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageRuleExecutionLog'

  /api/audit/transaction/{transactionId}:
    get:
      summary: Get audit logs for a specific transaction
      operationId: getTransactionAuditLogs
      parameters:
        - in: path
          name: transactionId
          required: true
          schema: { type: integer, format: int64 }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged audit logs for transaction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAuditLog'

  /api/audit:
    get:
      summary: List audit events
      operationId: listAudit
      parameters:
        - in: query
          name: actionType
          schema: { type: string }
        - in: query
          name: result
          schema: { type: string }
        - in: query
          name: startDate
          schema: { type: string, format: date-time }
        - in: query
          name: endDate
          schema: { type: string, format: date-time }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged audit logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAuditLog'
  /api/metrics:
    get:
      summary: Get system metrics
      operationId: getMetrics
      parameters:
        - in: query
          name: period
          schema: { type: string, example: 24h }
      responses:
        '200':
          description: Metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Metrics'
  /api/metrics/mcc:
    get:
      summary: Get metrics grouped by MCC
      operationId: getMetricsByMcc
      parameters:
        - in: query
          name: period
          schema: { type: string, example: 24h }
      responses:
        '200':
          description: Metrics by MCC
          content:
            application/json:
              schema:
                type: object
  /api/metrics/merchant:
    get:
      summary: Get metrics grouped by merchant
      operationId: getMetricsByMerchant
      parameters:
        - in: query
          name: period
          schema: { type: string, example: 24h }
      responses:
        '200':
          description: Metrics by merchant
          content:
            application/json:
              schema:
                type: object
  /api/metrics/timeline:
    get:
      summary: Get metrics timeline
      operationId: getMetricsTimeline
      parameters:
        - in: query
          name: granularity
          schema: { type: string, example: hour }
      responses:
        '200':
          description: Metrics timeline
          content:
            application/json:
              schema:
                type: object

  # =============================================================================
  # HOMOLOG ENDPOINTS (Bank-Grade Rule Management)
  # =============================================================================

  /api/homolog/rules:
    post:
      summary: Create a new homolog rule version (ADMIN only)
      operationId: createHomologRule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateHomologRuleRequest'
      responses:
        '200':
          description: Created rule version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleVersionResponse'

  /api/homolog/rules/{ruleId}/latest:
    get:
      summary: Get latest version of a homolog rule
      operationId: getLatestHomologRule
      parameters:
        - in: path
          name: ruleId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Latest rule version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleVersionResponse'
        '404':
          description: Rule not found

  /api/homolog/rules/versions/{ruleVersionId}/publish:
    post:
      summary: Publish a homolog rule version (ADMIN only)
      operationId: publishHomologRuleVersion
      parameters:
        - in: path
          name: ruleVersionId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Published rule version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleVersionResponse'

  /api/homolog/rules/{ruleId}/rollback/{version}:
    post:
      summary: Rollback a homolog rule to a specific version (ADMIN only)
      operationId: rollbackHomologRule
      parameters:
        - in: path
          name: ruleId
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: version
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Rolled back rule version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleVersionResponse'

  /api/homolog/rulesets:
    post:
      summary: Create a draft homolog rule set (ADMIN only)
      operationId: createHomologRuleSetDraft
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateHomologRuleSetRequest'
      responses:
        '200':
          description: Created rule set draft
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleSetVersionResponse'

  /api/homolog/rulesets/versions/{ruleSetVersionId}/publish:
    post:
      summary: Publish a homolog rule set version (ADMIN only)
      operationId: publishHomologRuleSetVersion
      parameters:
        - in: path
          name: ruleSetVersionId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Published rule set version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologRuleSetVersionResponse'

  /api/homolog/rulesets/activate:
    post:
      summary: Activate a homolog rule set version (ADMIN only)
      operationId: activateHomologRuleSet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivateHomologRuleSetRequest'
      responses:
        '200':
          description: Activated successfully

  /api/homolog/simulations/run:
    post:
      summary: Run a homolog simulation (ADMIN only)
      operationId: runHomologSimulation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HomologSimulationRequest'
      responses:
        '200':
          description: Simulation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomologSimulationResponse'

components:
  schemas:
    ValidateAstRequest:
      type: object
      required: [ast]
      properties:
        ast:
          description: Rule AST root node
          $ref: '#/components/schemas/AstNode'

    AstValidationResult:
      type: object
      required: [valid, errors]
      properties:
        valid: { type: boolean }
        errors:
          type: array
          items:
            $ref: '#/components/schemas/AstValidationError'

    FeatureDefinition:
      type: object
      required: [featureName, featureType, source, dataType, allowedOperators, version]
      properties:
        featureName: { type: string }
        featureType: { type: string }
        entityType: { type: string, nullable: true }
        windowName: { type: string, nullable: true }
        formula: { type: string, nullable: true }
        description: { type: string, nullable: true }
        source: { type: string }
        dataType: { type: string }
        allowedOperators:
          type: array
          items: { type: string }
        refreshStrategy: { type: string, nullable: true }
        version: { type: integer }

    AstLintResult:
      type: object
      required: [valid, errors, warnings]
      properties:
        valid: { type: boolean }
        errors:
          type: array
          items:
            $ref: '#/components/schemas/AstValidationError'
        warnings:
          type: array
          items: { type: object }

    AstValidationError:
      type: object
      required: [path, message]
      properties:
        path: { type: string }
        message: { type: string }

    AstNode:
      type: object
      description: Minimal AST node (GROUP | CONDITION | FIELD | CONST | FUNC)
      properties:
        type: { type: string }

    FieldDictionaryEntry:
      type: object
      required: [jsonPath, type, allowedOperators, allowedFunctions]
      properties:
        workflow: { type: string }
        recordType: { type: string }
        portfolio: { type: string }
        jsonPath: { type: string }
        type: { type: string }
        domain: { type: object }
        sentinelValues: { type: object }
        allowedOperators:
          type: array
          items: { type: string }
        allowedFunctions:
          type: array
          items: { type: string }
        requirednessByContext: { type: object }
        securityConstraints: { type: object }
        normalizationAllowed: { type: boolean }

    RuleExecutionLog:
      type: object
      properties:
        id: { type: string, format: uuid }
        eventType: { type: string }
        correlationId: { type: string }
        externalTransactionId: { type: string }
        payloadRawHash: { type: string }
        attemptedPayloadHash: { type: string }
        tamper: { type: boolean }
        decision: { type: string }
        riskScore: { type: integer }
        rulesFiredJson: { type: object }
        decisionPathJson: { type: object }
        whyNotFiredJson: { type: object }
        featuresUsedJson:
          type: array
          items:
            $ref: '#/components/schemas/FeatureUsed'
        contextFlagsJson: { type: object }
        errorJson: { type: object }
        createdAt: { type: string, format: date-time }

    FeatureUsed:
      type: object
      description: Minimal, deterministic audit-friendly record of an input/feature/function used during evaluation.
      properties:
        source: { type: string }
        name: { type: string }
        entityKey: { type: string }
        featureVersion: { type: string }
        windowName: { type: string }
        valueHash: { type: string }
        valueMasked: { type: string }

    V31SimulateRequest:
      type: object
      required: [payload, rules]
      properties:
        payload:
          type: object
          additionalProperties: true
        rules:
          type: array
          items:
            $ref: '#/components/schemas/V31SimulateRule'

    V31SimulateRule:
      type: object
      required: [ruleName, decision, ast]
      properties:
        ruleName: { type: string }
        decision: { type: string }
        ast:
          type: object
          description: Rule AST root node (v3.1)
          additionalProperties: true

    V31SimulateResponse:
      type: object
      required: [status, rulesFired, decisionPath, whyNotFired, featuresUsed]
      properties:
        status: { type: string }
        rulesFired:
          type: array
          items:
            $ref: '#/components/schemas/V31SimulateFiredRule'
        decisionPath:
          type: object
          additionalProperties: true
        whyNotFired:
          type: array
          items:
            $ref: '#/components/schemas/V31SimulateWhyNot'
        featuresUsed:
          type: array
          items:
            $ref: '#/components/schemas/FeatureUsed'

    V31SimulateFiredRule:
      type: object
      properties:
        ruleName: { type: string }
        decision: { type: string }

    V31SimulateWhyNot:
      type: object
      properties:
        ruleName: { type: string }
        reason: { type: string }
        errors:
          type: array
          items:
            $ref: '#/components/schemas/AstValidationError'

    PageRuleExecutionLog:
      type: object
      required: [content, page, size, totalElements, totalPages]
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/RuleExecutionLog'
        page: { type: integer }
        size: { type: integer }
        totalElements: { type: integer, format: int64 }
        totalPages: { type: integer }
    AnalyzeTransactionRequest:
      type: object
      required:
        - externalTransactionId
        - customerIdFromHeader
        - customerAcctNumber
        - pan
        - transactionAmount
        - transactionDate
        - transactionTime
        - transactionCurrencyCode
        - mcc
        - consumerAuthenticationScore
        - externalScore3
        - cavvResult
        - eciIndicator
        - atcCard
        - atcHost
        - tokenAssuranceLevel
        - availableCredit
        - cardCashBalance
        - cardDelinquentAmount
      properties:
        workflow: { type: string }
        recordType: { type: string }
        dataSpecificationVersion: { type: number }
        clientIdFromHeader: { type: string }
        externalTransactionId: { type: string }
        customerIdFromHeader: { type: string }
        customerAcctNumber: { type: integer, format: int64 }
        pan: { type: string, description: 'Tokenizado/mascarado; nunca armazenar PAN em claro.' }
        merchantId: { type: string }
        merchantName: { type: string }
        transactionAmount: { type: number }
        transactionDate: { type: integer, description: 'YYYYMMDD' }
        transactionTime: { type: integer, description: 'HHMMSS' }
        gmtOffset: { type: string }
        transactionCurrencyCode: { type: integer }
        transactionCurrencyConversionRate: { type: number }
        merchantCountryCode: { type: string }
        merchantCity: { type: string }
        merchantState: { type: string }
        merchantPostalCode: { type: string }
        mcc: { type: integer }
        posEntryMode: { type: string }
        customerPresent: { type: string }
        authPostFlag: { type: string }
        authDecisionCode: { type: string }
        authResponseCode: { type: string }
        authId: { type: string }
        authIndicator: { type: integer }
        processorAuthReasonCode: { type: string }
        standinAdvice: { type: string }
        transactionType: { type: string }
        transactionCategory: { type: string }
        consumerAuthenticationScore: { type: integer }
        externalScore3: { type: integer }
        cavvResult: { type: integer }
        cavvKeyIndicator: { type: integer }
        secondFactorAuthCode: { type: string }
        cryptogramValid: { type: string }
        cvv2Response: { type: string }
        cvv2Present: { type: integer }
        pinVerifyCode: { type: string }
        cvvVerifyCode: { type: string }
        cvrofflinePinVerificationPerformed: { type: integer }
        cvrofflinePinVerificationFailed: { type: integer }
        cvvPinTryLimitExceeded: { type: integer }
        eciIndicator: { type: integer }
        atcCard: { type: integer }
        atcHost: { type: integer }
        tokenAssuranceLevel: { type: integer }
        tokenizationIndicator: { type: string }
        tokenId: { type: string }
        tokenRequestorId: { type: string }
        paymentInstrumentId: { type: string }
        availableCredit: { type: number }
        cardCashBalance: { type: number }
        cardDelinquentAmount: { type: number }
        cardSeqNum: { type: integer, nullable: true }
        cardExpireDate: { type: integer }
        cardMediaType: { type: string }
        cardAipStatic: { type: string }
        cardAipDynamic: { type: string }
        cardAipVerify: { type: string }
        cardAipRisk: { type: string }
        cardAipIssuerAuthentication: { type: string }
        cardAipCombined: { type: string }
        terminalId: { type: string }
        terminalType: { type: string }
        terminalEntryCapability: { type: string }
        posConditionCode: { type: string }
        posOffPremises: { type: integer }
        posCardCapture: { type: integer }
        posSecurity: { type: integer }
        terminalVerificationResults: { type: string }
        cardVerificationResults: { type: string }
        networkId: { type: string }
        atmOwner: { type: string }
        acquirerId: { type: string }
        acquirerCountry: { type: string }
        acquirerBin: { type: string, nullable: true }
        expandedBIN: { type: string }
        tranCode: { type: string }
        avsRequest: { type: string }
        checkNumber: { type: string }
        recordCreationDate: { type: integer }
        recordCreationTime: { type: integer }
        recordCreationMilliseconds: { type: integer }
        portfolio: { type: string }
        onUsMerchantId: { type: string }
        userIndicator01: { type: string }
        userIndicator03: { type: string }
        userIndicator04: { type: string }
        userIndicator05: { type: string }
        userIndicator08: { type: string }
        idMethod: { type: integer }
        userData01: { type: string }
        userData02: { type: string }
        userData03: { type: string }
        userData04: { type: string }
        userData05: { type: string }
        userData06: { type: string }
        userData06_2: { type: string }
        userData09: { type: string }
    TriggeredRule:
      type: object
      required: [name, weight, contribution]
      properties:
        name: { type: string }
        weight: { type: integer, minimum: 0, maximum: 100 }
        contribution: { type: integer, minimum: 0, maximum: 100 }
        detail: { type: string }
    AnalyzeTransactionResponse:
      type: object
      required:
        - transactionId
        - classification
        - riskScore
        - triggeredRules
        - reason
        - rulesetVersion
        - processingTimeMs
        - timestamp
        - success
      properties:
        transactionId: { type: string }
        classification: { type: string, enum: [APPROVED, SUSPICIOUS, FRAUD] }
        riskScore: { type: integer, minimum: 0, maximum: 100 }
        triggeredRules:
          type: array
          items: { $ref: '#/components/schemas/TriggeredRule' }
        reason: { type: string }
        rulesetVersion: { type: string }
        processingTimeMs: { type: integer, format: int64 }
        timestamp: { type: string, format: date-time }
        success: { type: boolean }
    RuleCondition:
      type: object
      required: [field, operator, value]
      properties:
        field: { type: string }
        operator: { type: string, enum: ['==','!=','>','<','>=','<=','IN','NOT_IN','CONTAINS','NOT_CONTAINS'] }
        value: { type: string }
    Rule:
      type: object
      required: [ruleName, ruleType, weight, enabled, classification, conditions, logicOperator]
      properties:
        id: { type: integer, format: int64 }
        ruleName: { type: string }
        description: { type: string }
        ruleType: { type: string, enum: [SECURITY, CONTEXT, VELOCITY, ANOMALY] }
        weight: { type: integer, minimum: 0, maximum: 100 }
        enabled: { type: boolean }
        classification: { type: string, enum: [APPROVED, SUSPICIOUS, FRAUD] }
        conditions:
          type: array
          items: { $ref: '#/components/schemas/RuleCondition' }
        logicOperator: { type: string, enum: [AND, OR] }
        version: { type: integer }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    AuditLog:
      type: object
      properties:
        id: { type: integer, format: int64 }
        transactionId: { type: integer, format: int64 }
        actionType: { type: string }
        description: { type: string }
        details: { type: string }
        performedBy: { type: string }
        result: { type: string }
        errorMessage: { type: string }
        sourceIp: { type: string }
        createdAt: { type: string, format: date-time }
    Metrics:
      type: object
      properties:
        totalTransactions: { type: integer, format: int64 }
        approvedTransactions: { type: integer, format: int64 }
        suspiciousTransactions: { type: integer, format: int64 }
        fraudTransactions: { type: integer, format: int64 }
        approvalRate: { type: number }
        suspiciousRate: { type: number }
        fraudRate: { type: number }
        period: { type: string }
        timestamp: { type: string, format: date-time }
    PageAnalyzeTransactionResponse:
      type: object
      properties:
        content:
          type: array
          items: { $ref: '#/components/schemas/AnalyzeTransactionResponse' }
        totalElements: { type: integer, format: int64 }
        totalPages: { type: integer }
        size: { type: integer }
        number: { type: integer }
    PageRule:
      type: object
      properties:
        content:
          type: array
          items: { $ref: '#/components/schemas/Rule' }
        totalElements: { type: integer, format: int64 }
        totalPages: { type: integer }
        size: { type: integer }
        number: { type: integer }
    PageAuditLog:
      type: object
      properties:
        content:
          type: array
          items: { $ref: '#/components/schemas/AuditLog' }
        totalElements: { type: integer, format: int64 }
        totalPages: { type: integer }
        size: { type: integer }
        number: { type: integer }

    RuleHistoryEntry:
      type: object
      properties:
        id: { type: integer, format: int64 }
        ruleId: { type: integer, format: int64 }
        ruleName: { type: string }
        action: { type: string }
        previousValue: { type: string }
        newValue: { type: string }
        changedBy: { type: string }
        changedAt: { type: string, format: date-time }

    # =============================================================================
    # HOMOLOG SCHEMAS
    # =============================================================================

    CreateHomologRuleRequest:
      type: object
      required: [name, decision, ast]
      properties:
        name: { type: string }
        decision: { type: string }
        ast:
          type: object
          additionalProperties: true

    HomologRuleVersionResponse:
      type: object
      properties:
        ruleId: { type: string, format: uuid }
        ruleVersionId: { type: string, format: uuid }
        name: { type: string }
        version: { type: integer }
        status: { type: string, enum: [DRAFT, PUBLISHED, DEPRECATED] }
        decision: { type: string }
        ast:
          type: object
          additionalProperties: true
        createdAt: { type: string, format: date-time }
        publishedAt: { type: string, format: date-time }

    CreateHomologRuleSetRequest:
      type: object
      required: [name, ruleVersionIds]
      properties:
        name: { type: string }
        ruleVersionIds:
          type: array
          items: { type: string, format: uuid }

    HomologRuleSetVersionResponse:
      type: object
      properties:
        ruleSetId: { type: string, format: uuid }
        ruleSetVersionId: { type: string, format: uuid }
        name: { type: string }
        version: { type: integer }
        status: { type: string, enum: [DRAFT, PUBLISHED, DEPRECATED] }
        rules:
          type: array
          items:
            $ref: '#/components/schemas/HomologRuleVersionResponse'
        createdAt: { type: string, format: date-time }
        publishedAt: { type: string, format: date-time }

    ActivateHomologRuleSetRequest:
      type: object
      required: [ruleSetVersionId]
      properties:
        ruleSetVersionId: { type: string, format: uuid }

    HomologSimulationRequest:
      type: object
      required: [ruleSetVersionId, payload]
      properties:
        ruleSetVersionId: { type: string, format: uuid }
        payload:
          type: object
          additionalProperties: true

    HomologSimulationResponse:
      type: object
      properties:
        status: { type: string }
        rulesFired:
          type: array
          items:
            type: object
            properties:
              ruleName: { type: string }
              decision: { type: string }
        decisionPath:
          type: object
          additionalProperties: true
        featuresUsed:
          type: array
          items:
            $ref: '#/components/schemas/FeatureUsed'
